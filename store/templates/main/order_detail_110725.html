{% extends 'main/base.html' %}

{% block title %}Order #{{ order.order_number }}{% endblock %}

{% block extra_css %}
<style>
    .luxury-gradient-bg {
        background: linear-gradient(to bottom right, #fafafa, #f2f2f2);
    }
    .dark .luxury-gradient-bg {
        background: linear-gradient(to bottom right, #2d3748, #1a202c);
    }
    .shadow-luxury {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 15px -5px rgba(0, 0, 0, 0.06);
    }
    .dark .shadow-luxury {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 15px -5px rgba(0, 0, 0, 0.2);
    }
    .animate-scale-in {
        animation: scaleIn 0.5s ease-out forwards;
        opacity: 0;
        transform: scale(0.95);
    }
    @keyframes scaleIn {
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <h2 class="text-4xl lg:text-5xl font-serif font-extrabold text-center text-amber-800 dark:text-amber-400 mb-12 animate-fadeIn delay-100">
        Order #{{ order.order_number }} Details
    </h2>

    <div class="luxury-gradient-bg rounded-2xl shadow-luxury p-6 md:p-10 border border-gray-100 dark:border-gray-700 mb-10 animate-scale-in delay-200">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">

            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-100 dark:border-gray-700 shadow-md">
                <h3 class="text-2xl font-serif font-bold text-gray-900 dark:text-gray-100 mb-5 pb-3 border-b border-gray-200 dark:border-gray-700">Order Summary</h3>
                <div class="space-y-3 text-gray-700 dark:text-gray-300 text-lg">
                    <p><strong>Order ID:</strong> <span class="font-mono text-gray-800 dark:text-gray-200">{{ order.order_number }}</span></p>
                    <p><strong>Placed On:</strong> <span class="text-gray-800 dark:text-gray-200">{{ order.created_at|date:"F j, Y, P" }}</span></p>
                    <p><strong>Last Updated:</strong> <span class="text-gray-800 dark:text-gray-200">{{ order.updated_at|date:"F j, Y, P" }}</span></p>
                    <p><strong>Status:</strong>
                        <span class="font-bold text-lg {% if order.status == 'Delivered' %}text-green-600{% elif order.status == 'Cancelled' %}text-red-600{% else %}text-blue-600 dark:text-blue-400{% endif %}">
                            {{ order.get_status_display }}
                        </span>
                    </p>
                    <p><strong>Payment Status:</strong>
                        <span class="font-bold text-lg {% if order.payment_status == 'Completed' %}text-green-600{% elif order.payment_status == 'Failed' %}text-red-600{% else %}text-blue-600 dark:text-blue-400{% endif %}">
                            {{ order.get_payment_status_display }}
                        </span>
                    </p>
                    <p><strong>Payment Method:</strong> <span class="text-gray-800 dark:text-gray-200">{{ order.payment_method|default:"Not specified" }}</span></p>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-2xl font-extrabold text-gray-900 dark:text-gray-100">Total Amount:
                        <span class="text-amber-800 dark:text-amber-400">${{ order.total_amount|floatformat:2 }}</span>
                    </p>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-100 dark:border-gray-700 shadow-md">
                <h3 class="text-2xl font-serif font-bold text-gray-900 dark:text-gray-100 mb-5 pb-3 border-b border-gray-200 dark:border-gray-700">Customer Details</h3>
                <div class="space-y-3 text-gray-700 dark:text-gray-300 text-lg">
                    {% if order.user %}
                        <p><strong>Account User:</strong> <span class="font-semibold text-gray-800 dark:text-gray-200">{{ order.user.username }}</span></p>
                        <p><strong>C-Code:</strong> <span class="font-mono text-gray-800 dark:text-gray-200">{{ order.user.c_code|default:"N/A" }}</span></p>
                    {% else %}
                        <p><strong>Account User:</strong> <span class="font-semibold text-gray-800 dark:text-gray-200">Guest Checkout</span></p>
                        <p><strong>C-Code:</strong> <span class="font-mono text-gray-800 dark:text-gray-200">N/A</span></p>
                    {% endif %}
                    <p><strong>Contact Name:</strong> <span class="text-gray-800 dark:text-gray-200">{{ order.customer_name }}</span></p>
                    <p><strong>Phone:</strong> <span class="text-gray-800 dark:text-gray-200">{{ order.customer_phone }}</span></p>
                    <p><strong>Ship To Address:</strong> <span class="text-gray-800 dark:text-gray-200 block mt-1 leading-relaxed">{{ order.customer_address }}</span></p>
                </div>
            </div>

        </div>
    </div>

    <h3 class="text-3xl lg:text-4xl font-serif font-bold text-gray-800 dark:text-gray-100 mb-8 text-center animate-fadeIn delay-300">Order Items</h3>
    {% if order.items.all %}
        <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-2xl shadow-luxury border border-gray-100 dark:border-gray-700 p-6 animate-scale-in delay-400">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th scope="col" class="py-4 px-6 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Item</th>
                        <th scope="col" class="py-4 px-6 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Code</th>
                        <th scope="col" class="py-4 px-6 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Qty</th>
                        <th scope="col" class="py-4 px-6 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Price</th>
                        <th scope="col" class="py-4 px-6 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Total</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                    {% for item in order.items.all %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            <td class="py-4 px-6 flex items-center">
                                {% if item.furniture.image %}
                                    <img src="{{ item.furniture.image.url }}" alt="{{ item.furniture.name }}" class="w-16 h-16 object-cover rounded-lg shadow mr-4 border border-gray-200 dark:border-gray-600">
                                {% endif %}
                                <span class="text-gray-800 dark:text-gray-200 font-medium">{{ item.furniture.name }}</span>
                            </td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 font-mono text-sm">{{ item.furniture.item_code|default:"N/A" }}</td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 text-base">{{ item.quantity }}</td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 text-base">${{ item.price_at_purchase|floatformat:2 }}</td>
                            <td class="py-4 px-6 text-gray-900 dark:text-gray-100 font-semibold text-base">${{ item.get_total|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-gray-600 dark:text-gray-400 text-center text-lg mt-8">No items found for this order.</p>
    {% endif %}

    <div class="mt-12 text-center space-y-4 sm:space-y-0 sm:space-x-6 flex flex-col sm:flex-row justify-center animate-fadeIn delay-500">
        <a href="{% url 'generate_invoice_pdf' order.id %}" class="inline-flex items-center px-8 py-3 border border-amber-600 dark:border-amber-500 text-base font-medium rounded-full shadow-lg text-amber-800 dark:text-amber-200 bg-white dark:bg-gray-700 hover:bg-amber-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-400 transition ease-in-out duration-300 transform hover:-translate-y-1">
            Download Invoice (PDF)
        </a>

        <a href="{% url 'user_order_history' %}" class="inline-flex items-center px-8 py-3 border border-transparent text-base font-medium rounded-full shadow-lg text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition ease-in-out duration-300 transform hover:-translate-y-1 mt-4 sm:mt-0">
            Back to Order History
        </a>
    </div>
</div>
{% endblock %}