{% extends 'main/base.html' %}

{% block title %}Order #{{ order.order_number }}{% endblock %}

{% block extra_css %}
<style>
    /* New: Very subtle, almost invisible off-white/light gray background */
    .minimal-bg {
        background-color: #fcfcfc; /* Near white */
    }
    .dark .minimal-bg {
        background-color: #1c2128; /* Slightly deeper dark for contrast */
    }

    /* New: Cleaner, more subtle shadow for elegance */
    .shadow-subtle {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.02);
    }
    .dark .shadow-subtle {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Animations remain similar, keeping that smooth entry */
    .animate-scale-in {
        animation: scaleIn 0.5s ease-out forwards;
        opacity: 0;
        transform: scale(0.98); /* Less aggressive scale-in */
    }
    @keyframes scaleIn {
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-500 { animation-delay: 0.5s; }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12 sm:px-6 lg:px-8 max-w-7xl"> {# Even wider for more whitespace #}
    <h2 class="text-4xl lg:text-5xl font-sans font-extrabold text-center text-gray-800 dark:text-gray-100 mb-16 pb-6 animate-fadeIn delay-100">
        Order <span class="text-amber-600 dark:text-amber-400">#{{ order.order_number }}</span> Details
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">

        {# Order Summary Card #}
        <div class="minimal-bg rounded-xl shadow-subtle p-8 border border-gray-100 dark:border-gray-800 animate-scale-in delay-200">
            <h3 class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">Order Summary</h3>
            <div class="space-y-4 text-gray-700 dark:text-gray-300 text-lg">
                <p><strong class="text-gray-800 dark:text-gray-200">Order ID:</strong> <span class="font-mono">{{ order.order_number }}</span></p>
                <p><strong class="text-gray-800 dark:text-gray-200">Placed On:</strong> {{ order.created_at|date:"F j, Y, P" }}</p>
                <p><strong class="text-gray-800 dark:text-gray-200">Last Updated:</strong> {{ order.updated_at|date:"F j, Y, P" }}</p>
                <p><strong class="text-gray-800 dark:text-gray-200">Status:</strong>
                    <span class="font-bold text-lg
                        {% if order.status == 'Delivered' %}text-green-600{% elif order.status == 'Cancelled' %}text-red-600{% else %}text-blue-600 dark:text-blue-400{% endif %}">
                        {{ order.get_status_display }}
                    </span>
                </p>
                <p><strong class="text-gray-800 dark:text-gray-200">Payment Status:</strong>
                    <span class="font-bold text-lg
                        {% if order.payment_status == 'Completed' %}text-green-600{% elif order.payment_status == 'Failed' %}text-red-600{% else %}text-blue-600 dark:text-blue-400{% endif %}">
                        {{ order.get_payment_status_display }}
                    </span>
                </p>
                <p><strong class="text-gray-800 dark:text-gray-200">Payment Method:</strong> {{ order.payment_method|default:"Not specified" }}</p>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                <p class="text-3xl font-extrabold text-gray-900 dark:text-gray-100">Total Amount:
                    <span class="text-amber-600 dark:text-amber-400">${{ order.total_amount|floatformat:2 }}</span>
                </p>
            </div>
        </div>

        {# Customer Details Card #}
        <div class="minimal-bg rounded-xl shadow-subtle p-8 border border-gray-100 dark:border-gray-800 animate-scale-in delay-300">
            <h3 class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">Customer Details</h3>
            <div class="space-y-4 text-gray-700 dark:text-gray-300 text-lg">
                {% if order.user %}
                    <p><strong class="text-gray-800 dark:text-gray-200">Account User:</strong> <span class="font-semibold">{{ order.user.username }}</span></p>
                    <p><strong class="text-gray-800 dark:text-gray-200">C-Code:</strong> <span class="font-mono">{{ order.user.c_code|default:"N/A" }}</span></p>
                {% else %}
                    <p><strong class="text-gray-800 dark:text-gray-200">Account User:</strong> <span class="font-semibold">Guest Checkout</span></p>
                    <p><strong class="text-gray-800 dark:text-gray-200">C-Code:</strong> <span class="font-mono">N/A</span></p>
                {% endif %}
                <p><strong class="text-gray-800 dark:text-gray-200">Contact Name:</strong> {{ order.customer_name }}</p>
                <p><strong class="text-gray-800 dark:text-gray-200">Phone:</strong> {{ order.customer_phone }}</p>
                <p><strong class="text-gray-800 dark:text-gray-200">Ship To Address:</strong> <span class="block mt-2 leading-relaxed">{{ order.customer_address }}</span></p>
            </div>
        </div>

        {# Shipping & Notes Card (Optional - you can add content here) #}
        <div class="minimal-bg rounded-xl shadow-subtle p-8 border border-gray-100 dark:border-gray-800 animate-scale-in delay-400 md:col-span-2 lg:col-span-1">
            <h3 class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">Additional Information</h3>
            <div class="space-y-4 text-gray-700 dark:text-gray-300 text-lg">
                <p><strong>Shipping Notes:</strong> Currently not specified.</p>
                <p><strong>Delivery Estimate:</strong> 3-5 business days.</p>
                <p><strong>Support Contact:</strong> <a href="mailto:support@inhousemm.com" class="text-blue-600 hover:underline">support@inhousemm.com</a></p>
            </div>
        </div>

    </div>

    <h3 class="text-3xl lg:text-4xl font-semibold text-gray-800 dark:text-gray-100 mb-10 text-center animate-fadeIn delay-400">Order Items</h3>
    {% if order.items.all %}
        <div class="overflow-hidden minimal-bg rounded-xl shadow-subtle border border-gray-100 dark:border-gray-800 p-6 animate-scale-in delay-500">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th scope="col" class="py-5 px-6 text-left text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Item</th>
                        <th scope="col" class="py-5 px-6 text-left text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Code</th>
                        <th scope="col" class="py-5 px-6 text-left text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Qty</th>
                        <th scope="col" class="py-5 px-6 text-left text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Price</th>
                        <th scope="col" class="py-5 px-6 text-left text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider">Total</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 dark:divide-gray-700"> {# Lighter divider for minimalist feel #}
                    {% for item in order.items.all %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            <td class="py-4 px-6 flex items-center">
                                {% if item.furniture.image %}
                                    <img src="{{ item.furniture.image.url }}" alt="{{ item.furniture.name }}" class="w-16 h-16 object-cover rounded-md shadow-sm mr-4 border border-gray-100 dark:border-gray-600">
                                {% endif %}
                                <span class="text-gray-800 dark:text-gray-200 font-medium text-base">{{ item.furniture.name }}</span>
                            </td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 font-mono text-sm">{{ item.furniture.item_code|default:"N/A" }}</td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 text-base">{{ item.quantity }}</td>
                            <td class="py-4 px-6 text-gray-700 dark:text-gray-300 text-base">${{ item.price_at_purchase|floatformat:2 }}</td>
                            <td class="py-4 px-6 text-gray-900 dark:text-gray-100 font-semibold text-lg">${{ item.get_total|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-gray-600 dark:text-gray-400 text-center text-xl mt-10">No items found for this order.</p>
    {% endif %}

    <div class="mt-16 text-center space-y-6 sm:space-y-0 sm:space-x-8 flex flex-col sm:flex-row justify-center animate-fadeIn delay-500">
        <a href="{% url 'generate_invoice_pdf' order.id %}" class="inline-flex items-center px-10 py-4 border border-amber-500 text-lg font-medium rounded-full shadow-md text-amber-700 dark:text-amber-200 bg-white dark:bg-gray-800 hover:bg-amber-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-400 transition ease-in-out duration-300 transform hover:-translate-y-0.5">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            Download Invoice (PDF)
        </a>

        <a href="{% url 'user_order_history' %}" class="inline-flex items-center px-10 py-4 border border-transparent text-lg font-medium rounded-full shadow-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition ease-in-out duration-300 transform hover:-translate-y-0.5 mt-4 sm:mt-0">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0z"></path></svg>
            Back to Order History
        </a>
    </div>
</div>
{% endblock %}